-- CREATED

DROP DATABASE novoanjo;
create database novoanjo
DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

use novoanjo;

create table usuario(
id_usuario bigint not null auto_increment primary key,
nome varchar(50) not null,
sexo enum('M','F') not null,
nascimento date not null,
criacao datetime not null default CURRENT_TIMESTAMP,
id_perfil bigint not null,
id_servico bigint not null
)default charset = utf8;

create table login(
id_login bigint not null auto_increment primary key,
email varchar(100) not null unique,
senha varchar(100) not null,
id_usuario bigint unique not null
)default charset = utf8;

create table evento(
id_evento bigint not null auto_increment primary key,
responsavel varchar(70) not null,
data_evento date not null,
hora_evento time not null,
status enum('APROVADO', 'PENDENTE') not null,
criacao datetime not null default CURRENT_TIMESTAMP,
id_telefone bigint not null,
id_endereco bigint not null,
id_servico bigint not null
)default charset = utf8;

create table endereco(
id_endereco bigint not null auto_increment primary key,
estado char(2) not null,
cidade varchar(50) not null,
vizinhanca varchar(50) not null,
rua varchar (120) not null,
numero int not null,
complemento varchar(30),
id_usuario bigint unique
)default charset = utf8;

create table telefone(
id_telefone bigint not null auto_increment primary key,
numero VARCHAR(20) not null,
id_usuario bigint,
id_evento bigint
)default charset = utf8;

create table perfil(
id_perfil bigint not null auto_increment primary key,
tipo enum('ANJO', 'ACOLHIDO', 'ADMIN', 'MASTER')
)default charset = utf8;

create table servico(
id_servico bigint not null auto_increment primary key,
nome varchar(70) not null
)default charset = utf8;

create table gratidao(
id_gratidao bigint not null auto_increment primary key,
mensagem varchar(180) not null,
criacao datetime not null default CURRENT_TIMESTAMP,
id_usuario bigint not null
)default charset = utf8;

create table mensagem(
id_mensagem bigint not null auto_increment primary key,
texto varchar(200) not null,
data_fim date not null,
criacao datetime default CURRENT_TIMESTAMP,
id_usuario_responsavel bigint not null
)default charset = utf8;


ALTER TABLE usuario ENGINE=INNODB;
ALTER TABLE perfil ENGINE=INNODB;
ALTER TABLE login ENGINE=INNODB;
ALTER TABLE categoria ENGINE=INNODB;
ALTER TABLE evento ENGINE=INNODB;
ALTER TABLE telefone ENGINE=INNODB;
ALTER TABLE endereco ENGINE=INNODB;
ALTER TABLE ong ENGINE=INNODB;
ALTER TABLE doacao ENGINE=INNODB;

-- CONSTRANT

ALTER TABLE perfil ADD CONSTRAINT id_fk_usuarioP FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE login ADD CONSTRAINT id_fk_usuarioL FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE evento ADD CONSTRAINT id_fk_categoriaE FOREIGN KEY(id_categoria) REFERENCES categoria(id);
ALTER TABLE evento ADD CONSTRAINT id_fk_usuarioE FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE telefone ADD CONSTRAINT id_fk_usuarioT FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE telefone ADD CONSTRAINT id_fk_ongT FOREIGN KEY(id_ong) REFERENCES ong(id);
ALTER TABLE telefone ADD CONSTRAINT id_fk_eventoT FOREIGN KEY(id_evento) REFERENCES evento(id);
ALTER TABLE endereco ADD CONSTRAINT id_fk_eventoEn FOREIGN KEY(id_evento) REFERENCES evento(id);
ALTER TABLE endereco ADD CONSTRAINT id_fk_usuarioEn FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE endereco ADD CONSTRAINT id_fk_ongEn FOREIGN KEY(id_ong) REFERENCES ong(id);
ALTER TABLE ong ADD CONSTRAINT id_fk_telefoneO FOREIGN KEY(id_telefone) REFERENCES telefone(id);
ALTER TABLE ong ADD CONSTRAINT id_fk_enderecoO FOREIGN KEY(id_endereco) REFERENCES endereco(id);
ALTER TABLE doacao ADD CONSTRAINT id_fk_categoriaD FOREIGN KEY(id_categoria) REFERENCES categoria(id);
ALTER TABLE doacao ADD CONSTRAINT id_fk_usuarioD FOREIGN KEY(id_usuario) REFERENCES usuario(id);
ALTER TABLE auditoria ADD CONSTRAINT id_fk_usuarioA FOREIGN KEY(id_usuario) REFERENCES usuario(id);

-- SELECT




